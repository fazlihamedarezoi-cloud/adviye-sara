<!DOCTYPE html>
<html lang="fa">
<head>
<meta charset="UTF-8">
<title>سفارش عمده دارو</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{font-family:sans-serif;background:#f4f6f8;margin:0;padding:10px}
h1{text-align:center;margin-bottom:10px}
input{width:100%;padding:10px;margin-bottom:10px;border-radius:6px;border:1px solid #ccc}
.products{display:grid;grid-template-columns:repeat(auto-fit,minmax(170px,1fr));gap:15px}
.card{background:#fff;border-radius:10px;padding:10px;box-shadow:0 2px 6px rgba(0,0,0,.1);text-align:center;display:flex;flex-direction:column;align-items:center}
.card img{width:100%;height:140px;object-fit:contain}
.name{font-weight:bold;margin-top:5px}
.chemical{font-size:12px;color:#555;margin:3px 0}
.price{color:#0a7d3b;font-weight:bold;margin:5px 0}
.qty{width:60px;padding:6px;margin:5px auto;text-align:center;display:block}
.total{font-size:13px;margin:5px 0}
button{width:100%;padding:8px;background:#25d366;color:#fff;border:none;border-radius:6px;font-size:14px;cursor:pointer;margin-top:5px}
.warning{color:#c00;font-size:13px;text-align:center;margin-bottom:10px}
.orderAll{background:#128C7E;margin-top:15px}
</style>
</head>

<body>

<h1>سفارش عمده دارو</h1>

<input id="store" placeholder="نام داروخانه">
<input id="search" placeholder="جستجوی دارو">

<div class="products" id="products"></div>
<div class="warning" id="warn"></div>
<button class="orderAll" onclick="orderAll()">سفارش همه محصولات در واتساپ</button>

<script>
const whatsappNumber="93779369926";
const MIN_TOTAL=3000;

let allProducts=[];
let productElems=[];

fetch("products.json")
.then(r=>r.json())
.then(d=>{
  allProducts=d;
  render(d);
});

function render(list){
  const box=document.getElementById("products");
  box.innerHTML="";
  productElems=[];
  list.forEach(p=>{
    const card=document.createElement("div");
    card.className="card";
    card.innerHTML=`
      <img src="${p.image}">
      <div class="name">${p.name}</div>
      <div class="chemical">${p.chemical}</div>
      <div class="price">${p.price} افغانی</div>
      <input class="qty" type="number" value="1" onchange="updateTotal(this,${p.price})">
      <div class="total">جمع: ${p.price} افغانی</div>
    `;
    box.appendChild(card);
    productElems.push({elem:card, price:p.price, name:p.name});
  });
}

function updateTotal(input,price){
  let q=parseInt(input.value);
  if(isNaN(q)||q<1) q=1;
  input.value=q;
  input.nextElementSibling.innerText="جمع: "+(q*price)+" افغانی";
}

function orderAll(){
  const store=document.getElementById("store").value.trim();
  if(!store){alert("لطفاً نام داروخانه را وارد کنید"); return;}

  let totalAll=0;
  let textLines=[];
  productElems.forEach(p=>{
    const qty=parseInt(p.elem.querySelector(".qty").value);
    if(qty>0){
      const total=qty*p.price;
      totalAll+=total;
      textLines.push(`${p.name} - تعداد: ${qty} - جمع: ${total} افغانی`);
    }
  });

  if(totalAll<MIN_TOTAL){
    alert("حداقل مبلغ سفارش "+MIN_TOTAL+" افغانی است");
    return;
  }

  const text=`انتخاب ما، انتخاب کیفیت، اطمینان و رضایت مشتریان است.

سفارش عمده دارو
داروخانه: ${store}

`+textLines.join("\n")+`

جمع کل: ${totalAll} افغانی`;

  window.open("https://wa.me/"+whatsappNumber+"?text="+encodeURIComponent(text),"_blank");
}

document.getElementById("search").oninput=function(){
  const v=this.value.toLowerCase();
  render(allProducts.filter(p=>p.name.toLowerCase().includes(v)));
};
</script>

</body>
</html>
